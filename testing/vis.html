<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title></title>
    <meta name="description" content="">
    <meta name="author" content="">


    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega/3.3.1/vega.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.5.2/vega-lite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.15.0/vega-embed.min.js"></script>
    <script src="./records.js"></script>
    <script>  
        document.addEventListener('DOMContentLoaded', function () {
            colorHGA = 'red'
            colorManual = 'blue'

            const markers = function (attr, offset, axisTitle) {
                const color = attr.includes('HGA') ? colorHGA : colorManual;

                return {
                    "mark": {
                        "type": "circle",
                        "color": color,
                        "xOffset": offset
                    },
                    "encoding": {
                        "y": {
                            "field": attr,
                            "type": "quantitative",
                            "axis": { "title": axisTitle }
                        }
                    },
                }
            }

            const averageMarker = function (attr, offset, aggregator) {
                return {

                    "mark": {
                        "type": "circle",
                        "xOffset": offset
                    },
                    "encoding": {
                        "y": {
                            "aggregate": aggregator,
                            "field": attr,
                            "type": "quantitative"
                        },
                        "color": { "value": "black" },
                        "fill": { "value": "black" },
                        "size": { "value": "100" },
                    }

                }
            }
            const averageText = function (attr, offsetX, offsetY, aggregator) {
                return {
                    "mark": {
                        "type": "text",
                        "align": "left",
                        "dy": offsetY,
                        "dx": offsetX
                    },
                    "encoding": {

                        "y": {
                            "aggregate": aggregator,
                            "field": attr,
                            "type": "quantitative"
                        },
                        "text": {
                            "aggregate": aggregator,
                            "field": attr,
                            "type": "quantitative"
                        }
                    }

                }
            }

            const cols = [-20, 20]
            const h = 400
            const w = 130

            var specTime = {
                "data": data,
                "hconcat": [
                    {
                        "title": {
                            "text": 'all localities'
                        },
                        "width": w,
                        "height": h,
                        "layer": [
                            markers('Time_Manual', cols[0], 'time [s]'),
                            averageMarker('Time_Manual', cols[0], 'median'),
                            averageText('Time_Manual', cols[0] - 30, 0, 'median'),
                            markers('Time_HGA', cols[1], 'time [s]'),
                            averageMarker('Time_HGA', cols[1], 'median'),
                            averageText('Time_HGA', cols[1] + 10, 0, 'median'),
                        ],
                    },
                    {
                        "width": w,
                        "height": h,
                        "transform": [{ "filter": { "field": "Time_All", "lte": "150" } }],
                        "layer": [
                            markers('Time_Manual', cols[0], ''),
                            averageMarker('Time_Manual', cols[0], 'median'),
                            averageText('Time_Manual', cols[0] - 30, 0, 'median'),
                            markers('Time_HGA', cols[1], ''),
                            averageMarker('Time_HGA', cols[1], 'median'),
                            averageText('Time_HGA', cols[1] + 10, 0, 'median')
                        ],
                    },
                    {
                        "width": w,
                        "height": h,
                        "transform": [{ "filter": { "field": "Time_All", "gte": "150" } }],
                        "layer": [
                            markers('Time_Manual', cols[0], ''),
                            averageMarker('Time_Manual', cols[0], 'median'),
                            averageText('Time_Manual', cols[0] - 30, 0, 'median'),
                            markers('Time_HGA', cols[1], ''),
                            averageMarker('Time_HGA', cols[1], 'median'),
                            averageText('Time_HGA', cols[1] + 10, 0, 'median')
                        ],
                    },
                ],
                config: {
                    numberFormat: ".3",
                    title: {}
                }
            };
            var specAccuracy = {
                "data": data,
                "hconcat": [
                    {
                        "width": w,
                        "height": h,
                        "layer": [
                            markers('Precision_Manual', -20, 'precision'),
                            averageMarker('Precision_Manual', -20, 'median'),
                            averageText('Precision_Manual', -60, 0, 'median'),
                            markers('Precision_HGA', 20, 'precision'),
                            averageMarker('Precision_HGA', 20, 'median'),
                            averageText('Precision_HGA', 30, 0, 'median'),
                        ],
                    },
                    {
                        "width": w,
                        "height": h,
                        "transform": [{ "filter": { "field": "Time_All", "lte": "150" } }],
                        "layer": [
                            markers('Precision_Manual', -20, ''),
                            averageMarker('Precision_Manual', -20, 'average'),
                            averageText('Precision_Manual', -60, 0, 'average'),
                            markers('Precision_HGA', 20, ''),
                            averageMarker('Precision_HGA', 20, 'average'),
                            averageText('Precision_HGA', 30, 0, 'average'),
                        ],
                    },
                    {
                        "width": w,
                        "height": h,
                        "transform": [{ "filter": { "field": "Time_All", "gte": "150" } }],
                        "layer": [
                            markers('Precision_Manual', -20, ''),
                            averageMarker('Precision_Manual', -20, 'average'),
                            averageText('Precision_Manual', -60, 0, 'average'),
                            markers('Precision_HGA', 20, ''),
                            averageMarker('Precision_HGA', 20, 'average'),
                            averageText('Precision_HGA', 30, 0, 'average'),
                        ],
                    },
                ],
                config: {
                    numberFormat: ".3"
                }
            };
            vegaEmbed('#vis-time', specTime, { actions: false });
            vegaEmbed('#vis-accuracy', specAccuracy, { actions: false });
        });
    </script>
</head>

<body>
    <div id="vis-time"></div>
    <div id="vis-accuracy"></div>
</body>

</html>